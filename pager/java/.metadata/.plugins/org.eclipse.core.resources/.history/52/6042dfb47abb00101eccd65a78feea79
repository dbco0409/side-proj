<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>
    제품 관리
  </title>
  <!-- Favicon -->
  <link href="/assets/img/brand/favicon.png" rel="icon" type="image/png">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <!-- Icons -->
  <link href="/assets/js/plugins/nucleo/css/nucleo.css" rel="stylesheet" />
  <link href="/assets/js/plugins/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link href="/assets/css/argon-dashboard.css?v=1.1.2" rel="stylesheet" />
</head>

<body class="">
  <header th:replace="~{/fragments/admin.head :: commonHead('메인 페이지')}"></header>

  <div class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
      <div class="container-fluid">
        <!-- Brand -->
        <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="/admin/shop/list">제품 관리</a>
      </div>
    </nav>
    <!-- End Navbar -->

    <!-- Header -->
    <div class="header bg-gradient-primary pb-8 pt-5 pt-md-8"></div>

    <!-- ✅ Form 시작 -->
    <form th:action="${shop.id}? @{/admin/shop/edit/{id}(id=${shop.id})}  : @{/admin/shop/add}" method="post" enctype="multipart/form-data">
 	<div class="container-fluid mt--7">
        <div class="row">
          <div class="col">
            <div class="card shadow">
              
              <!-- ✅ 카드 헤더 -->
              <div class="card-header border-0">
                <div class="row">
                  <div class="col-8">
                    <h3 class="mb-0">제품 관리</h3>
                  </div>
                  <div class="col-4 text-right">
                    <button type="button" class="btn btn-light" onclick="location.href='/admin/shop/list'">목록</button>
                    <button type="submit" class="btn btn-primary" 
                            th:text="${shop.id} != null ? '수정하기' : '작성하기'"></button>
                  </div>
                </div>
              </div>

              <!-- ✅ 카드 본문 -->
              <div class="card-body">
                <div class="pl-lg-4">

                  <!-- 썸네일 -->
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                        <label class="form-control-label" for="input-thumb">썸네일 이미지</label>
                        <input type="file" id="input-thumb" name="thumbFile"
                               class="form-control form-control-alternative">
                      </div>
                    </div>
                  </div>

                  <!-- 제품명 & 제품사 -->
                  <div class="row">
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label">제품명</label>
                        <input type="text" name="title"
                               class="form-control form-control-alternative"
                               th:value="${shop.title}">
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label">제품사</label>
                        <input type="text" name="company"
                               class="form-control form-control-alternative"
                               th:value="${shop.company}">
                      </div>
                    </div>
                  </div>

                  <!-- 카테고리 -->
                  <div class="row">
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label">분류1</label><br>
                        <label><input type="checkbox" name="category1" value="문구" th:checked="${shop.category1 == '문구'}"> 문구</label>
                        <label><input type="checkbox" name="category1" value="리빙" th:checked="${shop.category1 == '리빙'}"> 리빙</label>
                        <label><input type="checkbox" name="category1" value="패션" th:checked="${shop.category1 == '패션'}"> 패션</label>
                        <label><input type="checkbox" name="category1" value="패션" th:checked="${shop.category1 == '사무용품'}"> 사무용품</label>
                        <label><input type="checkbox" name="category1" value="패션" th:checked="${shop.category1 == '전자제품'}"> 전자제품</label>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label">분류2</label><br>
                        <label><input type="checkbox" name="category2" value="사무실" th:checked="${shop.category2 == '사무실'}"> 사무실</label>
                        <label><input type="checkbox" name="category2" value="집안" th:checked="${shop.category2 == '집안'}"> 집안</label>
                        <label><input type="checkbox" name="category2" value="야외" th:checked="${shop.category2 == '야외'}"> 야외</label>
                        <label><input type="checkbox" name="category2" value="카페" th:checked="${shop.category2 == '카페'}"> 카페</label>
                      </div>
                    </div>
                  </div>

                  <!-- 가격 & 배달비 -->
                  <div class="row">
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label">제품가격</label><br>
                        <input type="text" name="price"
                               class="form-control form-control-alternative"
                               th:value="${shop.price}" style="width:80%; display:inline-block; margin-right:10px;">원
                      </div>
                    </div>
                    <div class="col-lg-5">
                      <div class="form-group">
                        <label class="form-control-label">배달비</label><br>
                        <input type="text" name="delivery_price"
                               class="form-control form-control-alternative"
                               th:value="${shop.delivery_price}">
                      </div>
                    </div>
                  </div>
                  
                  <div class="row">
                  	<div class="col-lg-12">
                  		<div class="form-group">
	                        <label class="form-control-label">상세내용</label><br>
	                        <textarea id="summernote" name="content" th:text="${shop.content}"></textarea>
	                      </div>
                  	</div>
                  </div>

                  <!-- URL & HOT -->
                  <div class="row">
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label">연결 URL</label><br>
                        <input type="text" name="url"
                               class="form-control form-control-alternative"
                               th:value="${shop.url}">
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label">제품 표시</label><br>
                        <label><input type="checkbox" name="hot" class="form-checkbox" value="1"
                                      th:checked="${shop.hot == 1}"> HOT</label>
                      </div>
                    </div>
                  </div>

                </div><!-- /.pl-lg-4 -->
              </div><!-- /.card-body -->

            </div><!-- /.card -->
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </form>
    <!-- ✅ Form 끝 -->
    
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
	
	<script>
	document.addEventListener("DOMContentLoaded", function() {
	  const editor = $('#summernote');
	
	  // ✅ Summernote 초기화
	  editor.summernote({
	    height: 400,
	    lang: 'ko-KR',
	    placeholder: '상세내용을 입력하세요.',
	    toolbar: [
	      ['style', ['bold', 'italic', 'underline', 'clear']],
	      ['font', ['fontsize', 'color']],
	      ['para', ['ul', 'ol', 'paragraph']],
	      ['insert', ['picture', 'link', 'video']],
	      ['view', ['fullscreen', 'codeview', 'help']]
	    ],
	    callbacks: {
	      onImageUpload: function(files) {
	        Array.from(files).forEach(file => uploadImage(file));
	      },
	      onMediaDelete: function(target) {
	        const src = target[0].src;
	        deleteImage(src);
	      }
	    }
	  });
	
	  // ✅ 이미지 업로드 (AJAX)
	  function uploadImage(file) {
	    const formData = new FormData();
	    formData.append("file", file);
	
	    fetch("/admin/shop/upload", {
	      method: "POST",
	      body: formData
	    })
	      .then(async (res) => {
	        if (!res.ok) throw new Error(await res.text());
	        return res.json();
	      })
	      .then((data) => {
	        if (data.success && data.url) {
	          editor.summernote('insertImage', data.url);
	        } else {
	          alert("이미지 업로드 실패: 서버 응답 없음");
	        }
	      })
	      .catch(err => {
	        console.error("Upload error:", err);
	        alert("이미지 업로드 중 오류가 발생했습니다.");
	      });
	  }
	
	  // ✅ (선택) 에디터 이미지 삭제 시 서버에서도 삭제
	  function deleteImage(imageUrl) {
	    fetch("/admin/shop/delete-image", {
	      method: "POST",
	      headers: { "Content-Type": "application/json" },
	      body: JSON.stringify({ url: imageUrl })
	    }).catch(err => console.warn("이미지 삭제 실패:", err));
	  }
	});
	</script>


  </div><!-- /.main-content -->

  <footer th:replace="~{fragments/admin.foot :: commonFoot('푸터 페이지')}"></footer>
</body>


</html>