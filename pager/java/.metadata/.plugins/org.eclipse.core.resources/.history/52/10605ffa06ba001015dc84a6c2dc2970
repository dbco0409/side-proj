<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>
    Pager AdminPage
  </title>
  <!-- Favicon -->
  <link href="/assets/img/brand/favicon.png" rel="icon" type="image/png">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <!-- Icons -->
  <link href="/assets/js/plugins/nucleo/css/nucleo.css" rel="stylesheet" />
  <link href="/assets/js/plugins/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link href="/assets/css/argon-dashboard.css?v=1.1.2" rel="stylesheet" />
</head>

<body class="">
  <header th:replace="~{/fragments/admin.head :: commonHead('메인 페이지')}"></header>
  <div class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
      <div class="container-fluid">
        <!-- Brand -->
        <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="../index.html">관리자 수정</a>
      </div>
    </nav>
    <!-- End Navbar -->
    <!-- Header -->
    <div class="header pb-8 pt-5 pt-lg-8 d-flex align-items-center" style="min-height: 80px;">
      <!-- Mask -->
      <span class="mask bg-gradient-default opacity-8"></span>
    </div>
    <!-- Page content -->
    <form action="/admin" method="post" id="registerForm">
    <div class="container-fluid mt--7">
      <div class="row">
        <div class="col-12">
          <div class="card bg-secondary shadow">
            <div class="card-header bg-white border-0">
              <div class="row align-items-center">
                <div class="col-8">
                  <h3 class="mb-0">관리자 정보</h3>
                </div>
                <div class="col-4 text-right">
                  <button type="submit" class="btn btn-primary">적용하기</button>
                </div>
              </div>
            </div>
            <div class="card-body">
                <h6 class="heading-small text-muted mb-4">Admin information</h6>
                <div class="pl-lg-4">
                  <div class="row">
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label" for="input-id">관리자 아이디</label>
                        <input type="text" id="input-id" name="mbId" class="form-control form-control-alternative" placeholder="아이디를 입력하세요."  th:value="${mbId}" readonly required>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label" for="input-password">비밀번호</label>
                        <input type="password" id="mbPassword" name="mbPassword" class="form-control form-control-alternative" placeholder="비밀번호를 입력하세요." required>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label" for="input-fname">관리자 이름</label>
                        <input type="text" id="input-fname" name="mbName" class="form-control form-control-alternative" placeholder="관리자 이름" th:value="${mbName}" required>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label" for="input-password-re">비밀번호 재확인</label>
                        <input type="password" id="mbPasswordRe" name="mbPasswordRe" class="form-control form-control-alternative" placeholder="비밀번호를 한번더 입력하세요." required>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  	</form>
  	<script>
		document.addEventListener("DOMContentLoaded", () => {
			document.querySelector("#registerForm").addEventListener("submit", async (e) => {
			  e.preventDefault(); // 폼 기본 제출 막기
		      const pw = document.getElementById('mbPassword').value.trim();
			  const pw2 = document.getElementById('mbPasswordRe').value.trim();
			
			  if (pw === '' || pw2 === '') {
			    alert('비밀번호를 입력해주세요.');
			    e.preventDefault();
			    return;
			  }
			
			  if (pw !== pw2) {
			    alert('비밀번호가 일치하지 않습니다. 다시 확인해주세요.');
			    e.preventDefault();
			    return;
			  } else{		
				try {
				  const res = await fetch("/admin/", {
				    method: "POST",
				    headers: { "Content-Type": "application/x-www-form-urlencoded" },
				    body: new URLSearchParams(new FormData(e.target)),
				  });

				  // 혹시 HTML이 돌아오더라도 안전하게 처리
				  const text = await res.text();
				  let result;
				  try {
				    result = JSON.parse(text);
				  } catch {
				    console.error("서버가 HTML 반환:", text);
				    alert("서버 오류가 발생했습니다.");
				    return;
				  }

				  if (result.success) {
				    window.location.href = "/admin/index";
				  } else {
				    alert(result.message);
				  }
				} catch (err) {
				  console.error(err);
				  alert("통신 오류가 발생했습니다.");
				}
			  }
			});
		});
		</script>
		
  </div>
  <footer th:replace="~{fragments/admin.foot :: commonFoot('푸터 페이지')}"></footer>
</body>

</html>