document.addEventListener('DOMContentLoaded', function() {
	
	document.getElementById('registerForm').addEventListener('submit', async function(e) {
		  e.preventDefault();
		  const pw = document.getElementById('mbPassword').value.trim();
		  const pw2 = document.getElementById('mbPasswordRe').value.trim();
		
		  if (pw === '' || pw2 === '') {
		    alert('비밀번호를 입력해주세요.');
		    e.preventDefault();
		    return;
		  }
		
		  if (pw !== pw2) {
		    alert('비밀번호가 일치하지 않습니다. 다시 확인해주세요.');
		    e.preventDefault();
		    return;
		  }
		
		  if (!document.getElementById('agree01').checked) {
		    alert('이용약관에 동의해야 회원가입이 가능합니다.');
		    e.preventDefault();
		    return;
		  }
		  
		  try {
			  const res = await fetch("/register", {
			    method: "POST",
			    headers: { "Content-Type": "application/x-www-form-urlencoded" },
			    body: new URLSearchParams(new FormData(e.target)),
			  });

			  // 혹시 HTML이 돌아오더라도 안전하게 처리
			  const text = await res.text();
			  let result;
			  try {
			    result = JSON.parse(text);
			  } catch {
			    console.error("서버가 HTML 반환:", text);
			    alert("서버 오류가 발생했습니다.");
			    return;
			  }

			  if (result.success) {
			    window.location.href = result.redirect;
			  } else {
			    alert(result.message);
			  }
			} catch (err) {
			  console.error(err);
			  alert("통신 오류가 발생했습니다.");
			}
		  }
	});
})

function agreePopup() {
	const checkbox = document.getElementById('agree01');
	const popup = document.getElementById('agreePopup');

	// 체크박스 자동 체크
	checkbox.checked = true;

	// 팝업 열기
	popup.style.display = 'block';
}

function closePopup() {
	document.getElementById('agreePopup').style.display = 'none';
}